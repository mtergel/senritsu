import {
  Box,
  Container,
  useColorMode,
  Avatar,
  Flex,
  Spacer,
  IconButton,
  Icon,
  Menu,
  MenuButton,
  MenuList,
  MenuItem,
  MenuDivider,
  useColorModeValue,
  HStack,
} from "@chakra-ui/react";
import { signout, useSession, signIn } from "next-auth/client";
import Link from "next/link";
import { IoSunnyOutline, IoMoonOutline, IoLogoGithub } from "react-icons/io5";
interface HeaderProps {}

const Header: React.FC<HeaderProps> = () => {
  const [session, loading] = useSession();
  const { colorMode, toggleColorMode } = useColorMode();
  const bg = useColorModeValue("#FFFFFF", "#000000");
  const sw = useColorModeValue(
    "rgba(0, 0, 0, 0.05)",
    "rgba(255, 255, 255, 0.08)"
  );
  return (
    <Box
      as="header"
      position="fixed"
      left={0}
      right={0}
      top={0}
      width="100%"
      backgroundColor={bg}
      transition="background-color 0.2s"
      boxShadow={`0 1px 2px 0 ${sw}`}
    >
      <Container maxW="1328px">
        <noscript>
          <style>{`.nojs-show { opacity: 1; top: 0; }`}</style>
        </noscript>
        <Box className={"nojs-show"}>
          <Flex width="100%" alignItems="center" height="100px">
            <Link href="/" passHref>
              <Box
                as="svg"
                height="2rem"
                width="auto"
                fill="none"
                viewBox="0 0 64 17"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5.886 16.144C4.29 16.144 3.012 15.844 2.052 15.244C1.092 14.632 0.612 13.702 0.612 12.454C0.612 11.794 0.726 11.29 0.954 10.942C1.182 10.594 1.518 10.42 1.962 10.42C2.286 10.42 2.55 10.504 2.754 10.672C2.958 10.84 3.06 11.056 3.06 11.32C3.06 11.56 3.042 11.77 3.006 11.95C3.006 11.998 2.994 12.082 2.97 12.202C2.958 12.322 2.952 12.448 2.952 12.58C2.952 13.12 3.222 13.522 3.762 13.786C4.314 14.05 5.082 14.182 6.066 14.182C7.086 14.182 7.884 14.002 8.46 13.642C9.036 13.27 9.324 12.754 9.324 12.094C9.324 11.686 9.192 11.338 8.928 11.05C8.664 10.75 8.334 10.504 7.938 10.312C7.542 10.108 6.984 9.862 6.264 9.574C5.34 9.214 4.584 8.872 3.996 8.548C3.42 8.224 2.922 7.786 2.502 7.234C2.094 6.67 1.89 5.974 1.89 5.146C1.89 4.282 2.118 3.514 2.574 2.842C3.042 2.17 3.708 1.648 4.572 1.276C5.448 0.903999 6.474 0.717999 7.65 0.717999C8.526 0.717999 9.33 0.849999 10.062 1.114C10.794 1.366 11.376 1.756 11.808 2.284C12.252 2.812 12.474 3.46 12.474 4.228C12.474 4.984 12.36 5.554 12.132 5.938C11.904 6.322 11.568 6.514 11.124 6.514C10.812 6.514 10.548 6.418 10.332 6.226C10.128 6.034 10.026 5.806 10.026 5.542C10.026 5.314 10.044 5.104 10.08 4.912C10.116 4.552 10.134 4.324 10.134 4.228C10.134 3.724 9.888 3.34 9.396 3.076C8.904 2.812 8.292 2.68 7.56 2.68C6.528 2.68 5.736 2.872 5.184 3.256C4.644 3.628 4.374 4.156 4.374 4.84C4.374 5.296 4.512 5.686 4.788 6.01C5.076 6.334 5.43 6.604 5.85 6.82C6.27 7.036 6.858 7.294 7.614 7.594C8.526 7.966 9.258 8.302 9.81 8.602C10.362 8.902 10.83 9.31 11.214 9.826C11.61 10.342 11.808 10.978 11.808 11.734C11.808 13.15 11.268 14.242 10.188 15.01C9.12 15.766 7.686 16.144 5.886 16.144ZM21.3725 11.986C21.5285 11.986 21.6485 12.058 21.7325 12.202C21.8285 12.346 21.8765 12.544 21.8765 12.796C21.8765 13.276 21.7625 13.648 21.5345 13.912C21.0905 14.452 20.4605 14.95 19.6445 15.406C18.8405 15.862 17.9765 16.09 17.0525 16.09C15.7925 16.09 14.8145 15.748 14.1185 15.064C13.4225 14.38 13.0745 13.444 13.0745 12.256C13.0745 11.428 13.2485 10.66 13.5965 9.952C13.9445 9.232 14.4245 8.662 15.0365 8.242C15.6605 7.822 16.3625 7.612 17.1425 7.612C17.8385 7.612 18.3965 7.822 18.8165 8.242C19.2365 8.65 19.4465 9.208 19.4465 9.916C19.4465 10.744 19.1465 11.458 18.5465 12.058C17.9585 12.646 16.9565 13.114 15.5405 13.462C15.8405 14.014 16.4105 14.29 17.2505 14.29C17.7905 14.29 18.4025 14.104 19.0865 13.732C19.7825 13.348 20.3825 12.85 20.8865 12.238C21.0305 12.07 21.1925 11.986 21.3725 11.986ZM16.8365 9.376C16.3925 9.376 16.0145 9.634 15.7025 10.15C15.4025 10.666 15.2525 11.29 15.2525 12.022V12.058C15.9605 11.89 16.5185 11.638 16.9265 11.302C17.3345 10.966 17.5385 10.576 17.5385 10.132C17.5385 9.904 17.4725 9.724 17.3405 9.592C17.2205 9.448 17.0525 9.376 16.8365 9.376ZM21.6889 16.09C21.2329 16.09 20.9089 15.85 20.7169 15.37C20.5369 14.89 20.4469 14.122 20.4469 13.066C20.4469 11.506 20.6689 10.024 21.1129 8.62C21.2209 8.272 21.3949 8.02 21.6349 7.864C21.8869 7.696 22.2349 7.612 22.6789 7.612C22.9189 7.612 23.0869 7.642 23.1829 7.702C23.2789 7.762 23.3269 7.876 23.3269 8.044C23.3269 8.236 23.2369 8.668 23.0569 9.34C22.9369 9.82 22.8409 10.24 22.7689 10.6C22.6969 10.96 22.6369 11.404 22.5889 11.932C22.9849 10.9 23.4289 10.06 23.9209 9.412C24.4129 8.764 24.8929 8.302 25.3609 8.026C25.8409 7.75 26.2789 7.612 26.6749 7.612C27.4549 7.612 27.8449 8.002 27.8449 8.782C27.8449 9.25 27.7129 10.096 27.4489 11.32C27.2209 12.364 27.1069 13.054 27.1069 13.39C27.1069 13.87 27.2809 14.11 27.6289 14.11C27.8689 14.11 28.1509 13.966 28.4749 13.678C28.8109 13.378 29.2549 12.898 29.8069 12.238C29.9509 12.07 30.1129 11.986 30.2929 11.986C30.4489 11.986 30.5689 12.058 30.6529 12.202C30.7489 12.346 30.7969 12.544 30.7969 12.796C30.7969 13.276 30.6829 13.648 30.4549 13.912C29.9389 14.548 29.3809 15.07 28.7809 15.478C28.1929 15.886 27.5209 16.09 26.7649 16.09C26.1529 16.09 25.6909 15.916 25.3789 15.568C25.0669 15.208 24.9109 14.692 24.9109 14.02C24.9109 13.684 24.9949 13.084 25.1629 12.22C25.3189 11.464 25.3969 10.942 25.3969 10.654C25.3969 10.462 25.3309 10.366 25.1989 10.366C25.0429 10.366 24.8209 10.57 24.5329 10.978C24.2569 11.374 23.9689 11.902 23.6689 12.562C23.3809 13.222 23.1469 13.918 22.9669 14.65C22.8349 15.214 22.6789 15.598 22.4989 15.802C22.3309 15.994 22.0609 16.09 21.6889 16.09ZM30.6186 16.09C30.1626 16.09 29.8386 15.85 29.6466 15.37C29.4666 14.89 29.3766 14.122 29.3766 13.066C29.3766 11.506 29.5986 10.024 30.0426 8.62C30.1506 8.272 30.3246 8.02 30.5646 7.864C30.8166 7.696 31.1646 7.612 31.6086 7.612C31.8486 7.612 32.0166 7.642 32.1126 7.702C32.2086 7.762 32.2566 7.876 32.2566 8.044C32.2566 8.236 32.1666 8.668 31.9866 9.34C31.8666 9.82 31.7706 10.24 31.6986 10.6C31.6266 10.96 31.5666 11.404 31.5186 11.932C31.9146 10.9 32.3586 10.06 32.8506 9.412C33.3426 8.764 33.8226 8.302 34.2906 8.026C34.7706 7.75 35.2086 7.612 35.6046 7.612C36.3846 7.612 36.7746 8.002 36.7746 8.782C36.7746 8.938 36.7206 9.316 36.6126 9.916C36.5166 10.396 36.4686 10.696 36.4686 10.816C36.4686 11.236 36.6186 11.446 36.9186 11.446C37.2546 11.446 37.6866 11.182 38.2146 10.654C38.3706 10.498 38.5326 10.42 38.7006 10.42C38.8566 10.42 38.9766 10.492 39.0606 10.636C39.1566 10.768 39.2046 10.948 39.2046 11.176C39.2046 11.62 39.0846 11.968 38.8446 12.22C38.5086 12.568 38.1126 12.868 37.6566 13.12C37.2126 13.36 36.7386 13.48 36.2346 13.48C35.5986 13.48 35.1126 13.318 34.7766 12.994C34.4526 12.67 34.2906 12.232 34.2906 11.68C34.2906 11.5 34.3086 11.32 34.3446 11.14C34.3686 10.9 34.3806 10.738 34.3806 10.654C34.3806 10.462 34.3146 10.366 34.1826 10.366C34.0026 10.366 33.7626 10.57 33.4626 10.978C33.1746 11.374 32.8866 11.902 32.5986 12.562C32.3106 13.222 32.0766 13.918 31.8966 14.65C31.7646 15.214 31.6086 15.598 31.4286 15.802C31.2606 15.994 30.9906 16.09 30.6186 16.09ZM39.89 6.424C39.386 6.424 39.008 6.31 38.756 6.082C38.504 5.842 38.378 5.512 38.378 5.092C38.378 4.672 38.54 4.324 38.864 4.048C39.2 3.76 39.614 3.616 40.106 3.616C40.55 3.616 40.91 3.724 41.186 3.94C41.462 4.156 41.6 4.462 41.6 4.858C41.6 5.338 41.444 5.722 41.132 6.01C40.82 6.286 40.406 6.424 39.89 6.424ZM39.746 16.09C38.966 16.09 38.396 15.814 38.036 15.262C37.688 14.71 37.514 13.978 37.514 13.066C37.514 12.526 37.58 11.836 37.712 10.996C37.856 10.144 38.036 9.352 38.252 8.62C38.36 8.236 38.504 7.972 38.684 7.828C38.864 7.684 39.152 7.612 39.548 7.612C40.16 7.612 40.466 7.816 40.466 8.224C40.466 8.524 40.352 9.22 40.124 10.312C39.836 11.632 39.692 12.526 39.692 12.994C39.692 13.354 39.74 13.63 39.836 13.822C39.932 14.014 40.094 14.11 40.322 14.11C40.538 14.11 40.808 13.96 41.132 13.66C41.456 13.36 41.888 12.886 42.428 12.238C42.572 12.07 42.734 11.986 42.914 11.986C43.07 11.986 43.19 12.058 43.274 12.202C43.37 12.346 43.418 12.544 43.418 12.796C43.418 13.276 43.304 13.648 43.076 13.912C41.888 15.364 40.778 16.09 39.746 16.09ZM49.9897 11.986C50.1457 11.986 50.2657 12.058 50.3497 12.202C50.4457 12.346 50.4937 12.544 50.4937 12.796C50.4937 13.276 50.3797 13.648 50.1517 13.912C49.6357 14.548 49.0717 15.07 48.4597 15.478C47.8477 15.886 47.1457 16.09 46.3537 16.09C43.9057 16.09 42.6817 14.368 42.6817 10.924C42.6817 10.396 42.6997 9.862 42.7357 9.322H42.0337C41.6737 9.322 41.4277 9.256 41.2957 9.124C41.1757 8.992 41.1157 8.782 41.1157 8.494C41.1157 7.822 41.3857 7.486 41.9257 7.486H42.9517C43.1557 6.166 43.4677 4.96 43.8877 3.868C44.3077 2.776 44.8117 1.906 45.3997 1.258C45.9997 0.609999 46.6417 0.286 47.3257 0.286C47.8297 0.286 48.2257 0.508 48.5137 0.952C48.8017 1.396 48.9457 1.954 48.9457 2.626C48.9457 4.486 48.1657 6.106 46.6057 7.486H48.6217C48.8137 7.486 48.9517 7.528 49.0357 7.612C49.1197 7.696 49.1617 7.852 49.1617 8.08C49.1617 8.908 48.4837 9.322 47.1277 9.322H44.9317C44.9077 9.922 44.8957 10.39 44.8957 10.726C44.8957 11.974 45.0397 12.85 45.3277 13.354C45.6277 13.858 46.0957 14.11 46.7317 14.11C47.2477 14.11 47.7037 13.954 48.0997 13.642C48.4957 13.33 48.9637 12.862 49.5037 12.238C49.6477 12.07 49.8097 11.986 49.9897 11.986ZM46.8397 2.014C46.6597 2.014 46.4557 2.242 46.2277 2.698C46.0117 3.142 45.8017 3.766 45.5977 4.57C45.4057 5.362 45.2437 6.244 45.1117 7.216C45.8197 6.604 46.3477 5.92 46.6957 5.164C47.0557 4.396 47.2357 3.7 47.2357 3.076C47.2357 2.368 47.1037 2.014 46.8397 2.014ZM52.3761 16.486C51.7521 16.486 51.2721 16.342 50.9361 16.054C50.6121 15.766 50.4501 15.442 50.4501 15.082C50.4501 14.77 50.5641 14.5 50.7921 14.272C51.0201 14.044 51.3561 13.93 51.8001 13.93C51.9561 13.93 52.1361 13.948 52.3401 13.984C52.5561 14.008 52.7181 14.026 52.8261 14.038C52.8141 13.726 52.7421 13.432 52.6101 13.156C52.4901 12.88 52.3341 12.616 52.1421 12.364C51.9501 12.1 51.7701 11.872 51.6021 11.68C51.2301 12.388 50.8581 12.976 50.4861 13.444C50.1261 13.912 49.7301 14.356 49.2981 14.776C49.0821 14.992 48.8541 15.1 48.6141 15.1C48.4221 15.1 48.2661 15.034 48.1461 14.902C48.0261 14.758 47.9661 14.584 47.9661 14.38C47.9661 14.14 48.0501 13.918 48.2181 13.714L48.4521 13.426C49.1121 12.61 49.6101 11.938 49.9461 11.41C50.1501 11.062 50.3901 10.6 50.6661 10.024C50.9421 9.436 51.2121 8.83 51.4761 8.206C51.7041 7.678 52.1781 7.414 52.8981 7.414C53.2341 7.414 53.4681 7.444 53.6001 7.504C53.7321 7.564 53.7981 7.66 53.7981 7.792C53.7981 7.864 53.7741 7.978 53.7261 8.134C53.6781 8.29 53.6121 8.446 53.5281 8.602C53.3121 9.034 53.2041 9.4 53.2041 9.7C53.2041 9.88 53.2641 10.078 53.3841 10.294C53.5161 10.51 53.7141 10.78 53.9781 11.104C54.3621 11.608 54.6501 12.04 54.8421 12.4C55.0461 12.748 55.1481 13.132 55.1481 13.552C55.1481 13.672 55.1361 13.84 55.1121 14.056C55.7001 13.828 56.3901 13.222 57.1821 12.238C57.3261 12.07 57.4881 11.986 57.6681 11.986C57.8241 11.986 57.9441 12.058 58.0281 12.202C58.1241 12.346 58.1721 12.544 58.1721 12.796C58.1721 13.252 58.0581 13.624 57.8301 13.912C57.2301 14.656 56.6541 15.166 56.1021 15.442C55.5621 15.706 54.8901 15.85 54.0861 15.874C53.6061 16.282 53.0361 16.486 52.3761 16.486ZM58.5817 16.09C58.0177 16.09 57.5617 15.862 57.2137 15.406C56.8777 14.938 56.7097 14.296 56.7097 13.48C56.7097 12.58 56.7697 11.758 56.8897 11.014C57.0097 10.258 57.2077 9.46 57.4837 8.62C57.6037 8.26 57.7717 8.002 57.9877 7.846C58.2037 7.69 58.5457 7.612 59.0137 7.612C59.2777 7.612 59.4577 7.654 59.5537 7.738C59.6617 7.822 59.7157 7.948 59.7157 8.116C59.7157 8.212 59.6497 8.536 59.5177 9.088C59.3977 9.532 59.3017 9.934 59.2297 10.294C58.9897 11.554 58.8697 12.394 58.8697 12.814C58.8697 13.066 58.8997 13.246 58.9597 13.354C59.0197 13.45 59.1157 13.498 59.2477 13.498C59.4277 13.498 59.6557 13.318 59.9317 12.958C60.2077 12.586 60.4957 12.034 60.7957 11.302C61.1077 10.558 61.4017 9.664 61.6777 8.62C61.7737 8.26 61.9177 8.002 62.1097 7.846C62.3137 7.69 62.6137 7.612 63.0097 7.612C63.2737 7.612 63.4597 7.684 63.5677 7.828C63.6877 7.96 63.7477 8.164 63.7477 8.44C63.7477 8.74 63.7237 9.076 63.6757 9.448C63.6277 9.808 63.5737 10.18 63.5137 10.564C63.3937 11.332 63.2977 12.034 63.2257 12.67C63.1537 13.294 63.1177 14.008 63.1177 14.812C63.1177 15.268 63.0217 15.598 62.8297 15.802C62.6497 15.994 62.3497 16.09 61.9297 16.09C61.4857 16.09 61.1737 15.976 60.9937 15.748C60.8257 15.508 60.7417 15.052 60.7417 14.38C60.7417 14.248 60.7537 13.954 60.7777 13.498C60.5737 14.338 60.2677 14.98 59.8597 15.424C59.4637 15.868 59.0377 16.09 58.5817 16.09Z"
                  fill="currentColor"
                />
              </Box>
            </Link>
            <Spacer />
            {!session && (
              <>
                <a
                  href={`/api/auth/signin`}
                  onClick={(e) => {
                    e.preventDefault();
                    signIn("spotify");
                  }}
                >
                  <button>Sign in</button>
                </a>
              </>
            )}
            {session && (
              <Flex>
                <HStack spacing="24px" marginRight="48px">
                  <Link href="https://github.com/mtergel/senritsu" passHref>
                    <a target="_blank" rel="noopener noreferrer">
                      <Icon
                        as={IoLogoGithub}
                        fontSize="3xl"
                        opacity="0.8"
                        transition="opacity 0.2s"
                        _hover={{
                          opacity: 1,
                        }}
                        _focus={{
                          opacity: 1,
                        }}
                      />
                    </a>
                  </Link>
                  <IconButton
                    onClick={toggleColorMode}
                    aria-label="toggle theme"
                    _focus={{
                      boxShadow: "none",
                    }}
                  >
                    {colorMode === "light" ? (
                      <Icon as={IoMoonOutline} fontSize="xl" />
                    ) : (
                      <Icon as={IoSunnyOutline} fontSize="xl" />
                    )}
                  </IconButton>
                </HStack>
                <Menu>
                  <MenuButton>
                    <Avatar
                      size="md"
                      name={session.user.name}
                      src={session.user.image}
                    />
                  </MenuButton>
                  <MenuList px={2}>
                    <MenuItem>Profile</MenuItem>
                    <MenuDivider />
                    <MenuItem
                      as="a"
                      href={`/api/auth/signout`}
                      onClick={(e) => {
                        e.preventDefault();
                        signout();
                      }}
                    >
                      Log out
                    </MenuItem>
                  </MenuList>
                </Menu>
              </Flex>
            )}
          </Flex>
        </Box>
      </Container>
    </Box>
  );
};
export default Header;
